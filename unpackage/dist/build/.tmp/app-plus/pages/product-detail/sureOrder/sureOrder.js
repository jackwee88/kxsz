(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product-detail/sureOrder/sureOrder"],{"5bb6":function(t,e,a){"use strict";a.r(e);var s=a("eb34"),i=a.n(s);for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);e["default"]=i.a},"80e7":function(t,e,a){"use strict";var s,i=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"b",function(){return i}),a.d(e,"c",function(){return o}),a.d(e,"a",function(){return s})},a8ff:function(t,e,a){"use strict";var s=a("e02a"),i=a.n(s);i.a},dbdf:function(t,e,a){"use strict";(function(t){a("f9cd"),a("921b");s(a("66fd"));var e=s(a("fa0c"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},e02a:function(t,e,a){},eb34:function(t,e,a){"use strict";(function(t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a("60db"),o=a("ec2b"),n={data:function(){return{invoiceArr:{},is_fp:"不开发票",dzxy:"",is_dzxy:"",ewm:"",is_ewm:!1,moneys:"",discount:"",integral:"109",storeimg:"https://kxsx-front-pic.oss-cn-beijing.aliyuncs.com/test/chanpintu.png",title:"多功能尺子教学全套课程",guankan:"永久观看",selected:!0,selected_integral:!1,type:1,ids:"",ct_id:"",p_id:"",goods:[],address:{},total:0,totals:"",flag_y:!1,flag_n:!1,prv_money:0,transport_total:0,selected_num:0,num:0,buy_num:1,now_buy:"",selected_other:!1,is_save:!1,order_id:"",explain:"",selected_explain:!0,price:"",goods_sku_id:"",goods_num:"",goods_spec_id:"",remarks:""}},components:{},props:{},onLoad:function(e){var a=this;wx.setStorageSync("a",[]),t("log",e," at pages\\product-detail\\sureOrder\\sureOrder.vue:321"),this.banner=JSON.parse(decodeURIComponent(e.sureOrder)),1==this.banner.now_buy&&(this.now_buy=1,this.goods_sku_id=this.banner.goods_sku_id,this.goods_num=this.banner.goods_num,this.buy_num=this.banner.goods_num,this.goods_spec_id=this.banner.goods_spec_id);var o=this;this.dzxyFun(),!o.banner.type||1!=o.banner.type&&2!=o.banner.type||(this.type=o.banner.type),o.banner.ids?this.ids=o.banner.ids:s.navigateBack({}),1==o.type?(this.p_id=o.ids,this.ct_id=""):2==o.type&&(this.p_id="",this.ct_id=o.ids);(0,i.ajax)({url:"goods/settlement",data:{ct_id:this.ct_id,p_id:this.p_id,goods_sku_id:this.goods_sku_id,goods_num:this.goods_num,goods_spec_id:this.goods_spec_id},success:function(e){0==e.data.data.send_status?s.showToast({title:"当前地址不在配送范围哦 ~",icon:"none"}):(a.goods=e.data.data.goods,t("log",a.goods," at pages\\product-detail\\sureOrder\\sureOrder.vue:367"),a.address=e.data.data.address,a.total=e.data.data.total,a.totals=e.data.data.total.toFixed(2),a.integral=e.data.data.score,a.transport_total=e.data.data.transport_total,a.price=e.data.data.total)}})},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{linkTo:function(){wx.navigateTo({url:"../../shoppingcart/shaddress/shaddress?quantity="+this.buy_num+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&score="+this.selected_integral+"&cp_id="+this.discount+"&goods_sku_id="+this.goods_sku_id})},changeData:function(t){this.setData({address:t})},pay:function(){var e=this,a=this;if(t("log","123"," at pages\\product-detail\\sureOrder\\sureOrder.vue:439"),this.selected_explain){if(1==this.now_buy){t("log",this.remarks," at pages\\product-detail\\sureOrder\\sureOrder.vue:456");var o={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,invoiceArr:this.invoiceArr,account:this.invoiceArr.content,account_type:this.invoiceArr.acc_type,goods_sku_id:a.goods_sku_id,mark:this.remarks}}else{t("log",this.remarks," at pages\\product-detail\\sureOrder\\sureOrder.vue:471");o={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,invoiceArr:this.invoiceArr,account:this.invoiceArr.content,account_type:this.invoiceArr.acc_type,goods_sku_id:a.goods_sku_id,mark:this.remarks}}1==this.selected_other?(0,i.ajax)({url:"goods/downOrder",data:{param:o},success:function(t){e.order_id=t.data.order_id,(0,i.ajax)({url:"goods/repay_other",data:{order_id:t.data.order_id},success:function(t){e.ewm=t.data.code,e.is_ewm=!0;var s=wx.getFileSystemManager();s.writeFile({filePath:wx.env.USER_DATA_PATH+"/test.png",data:a.ewm.slice(22),encoding:"base64",success:function(t){wx.saveImageToPhotosAlbum({filePath:wx.env.USER_DATA_PATH+"/test.png",success:function(t){this.is_save=!0},fail:function(t){}})},fail:function(t){}})}})}}):(0,i.ajax)({url:"goods/downOrder",data:o,success:function(t){2!=t.status?(0,i.ajax)({url:"paygoods/pay",data:{order_id:t.data.order_id},success:function(e){s.requestPayment({timeStamp:String(e.data.timeStamp),nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(e){s.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+t.data.order_id})},fail:function(){wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+t.data.order_id})},complete:function(){}})}}):s.showToast({title:t.msg,icon:"none"})}})}else s.showToast({title:"请先同意电子协议",icon:"none"})},linkToMy:function(t){var e=t.currentTarget.dataset.money;wx.navigateTo({url:"/pages/my/mydiscount/mydiscount?way=1&money="+e+"&prv_money="+this.prv_money+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&ar_id="+this.address.ar_id+"&score="+this.selected_integral+"&quantity="+this.buy_num+"&cp_id="+this.discount+"&price="+this.price+"&goods_sku_id="+this.goods_sku_id})},selectList:function(t){if(!this.address)return wx.showToast({title:"请先选择收货地址",icon:"none"}),!1;var e=this.integral/100,a=parseFloat(e.toFixed(2));if(this.setData({selected_integral:!this.selected_integral}),1==this.selected_integral){if(0==this.flag_y){this.setData({flag_n:!1});var s=(this.totals-a).toFixed(2);s<=0&&(s=.01),this.jf()}}else{if(0==this.flag_n){s=(parseFloat(this.totals)+parseFloat(a)).toFixed(2);this.jf()}this.setData({flag_y:!1})}},addCount:function(t){var e=t.currentTarget.dataset.index,a=(t.currentTarget.dataset.ct_id,t.currentTarget.dataset.goods_price),s=this.goods;if(parseFloat(s[e].quantity)+1<=1)return!1;s[e].quantity=parseFloat(s[e].quantity)+1;var i=parseFloat(a*s[e].quantity)+parseFloat(this.transport_total);this.setData({goods:s,totals:i.toFixed(2),buy_num:s[e].quantity}),this.jf()},minusCount:function(t){var e=this,a=t.currentTarget.dataset.index,s=(t.currentTarget.dataset.ct_id,t.currentTarget.dataset.coupon_price),i=this.goods;if(i[a].quantity<=1)return!1;i[a].quantity=parseFloat(i[a].quantity)-1;var o=parseFloat(s*i[a].quantity)+parseFloat(e.transport_total);this.setData({goods:i,totals:o.toFixed(2),buy_num:i[a].quantity}),this.jf()},changeNum:function(t){var e=this,a=t.currentTarget.dataset.index,s=t.currentTarget.dataset.coupon_price,i=e.goods;i[a].quantity=t.detail.value,e.setData({goods:i,buy_num:t.detail.value});var o=parseFloat(s*t.detail.value)+parseFloat(e.transport_total);e.setData({totals:o.toFixed(2)}),this.jf()},jf:function(){this.address||this.setData({address:""}),t("log",this.buy_num," at pages\\product-detail\\sureOrder\\sureOrder.vue:712");var e={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,goods_sku_id:this.goods_sku_id},a=this;o.ajax("/api/goods/OrderMoney",e,function(t){a.setData({integral:t.data.use_integral,totals:t.data.amount.toFixed(2),price:t.data.prices,transport_total:t.data.transport})})},selectListOther:function(t){this.setData({selected_other:!this.selected_other})},closeEwm:function(){this.setData({is_ewm:!1}),wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+this.order_id})},selectExplain:function(t){this.setData({selected_explain:!this.selected_explain})},explainFun:function(){this.setData({is_dzxy:!0})},hideExplain:function(){this.setData({is_dzxy:!1})},dzxyFun:function(){var t=this;(0,i.ajax)({url:"index/getSystemDesc",data:{type:5},success:function(e){t.dzxy=e.data.data}})},toDzxy:function(){wx.navigateTo({url:"/pages/dzxy/dzxy"})},invoice:function(){wx.navigateTo({url:"/pages/invoice/invoice"})},toTop:function(t){var e=this;e.pageScrollTo({scrollTop:0,duration:0})},bindRemarksAreaBlur:function(t){this.setData({remarks:t.detail.value})}}};e.default=n}).call(this,a("0de9")["default"],a("6e42")["default"])},fa0c:function(t,e,a){"use strict";a.r(e);var s=a("80e7"),i=a("5bb6");for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);a("a8ff");var n,d=a("f0c5"),r=Object(d["a"])(i["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],n);e["default"]=r.exports}},[["dbdf","common/runtime","common/vendor"]]]);