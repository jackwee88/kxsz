(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product-detail/sureOrder/sureOrder"],{"0c61":function(t,e,a){"use strict";var i,s=function(){var t=this,e=t.$createElement;t._self._c},o=[];a.d(e,"b",function(){return s}),a.d(e,"c",function(){return o}),a.d(e,"a",function(){return i})},"5bb6":function(t,e,a){"use strict";a.r(e);var i=a("eb34"),s=a.n(i);for(var o in i)"default"!==o&&function(t){a.d(e,t,function(){return i[t]})}(o);e["default"]=s.a},a8ff:function(t,e,a){"use strict";var i=a("e02a"),s=a.n(i);s.a},dbdf:function(t,e,a){"use strict";(function(t){a("f9cd"),a("921b");i(a("66fd"));var e=i(a("fa0c"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("6e42")["createPage"])},e02a:function(t,e,a){},eb34:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;a("60db");var i={data:function(){return{invoiceArr:{},is_fp:"不开发票",dzxy:"",is_dzxy:"",ewm:"",is_ewm:!1,moneys:"",discount:"",integral:"109",storeimg:"https://kxsx-front-pic.oss-cn-beijing.aliyuncs.com/test/chanpintu.png",title:"多功能尺子教学全套课程",guankan:"永久观看",selected:!0,selected_integral:!1,type:1,ids:"",ct_id:"",p_id:"",goods:[],address:{},total:0,totals:"",flag_y:!1,flag_n:!1,prv_money:0,transport_total:0,selected_num:0,num:0,buy_num:1,now_buy:"",selected_other:!1,is_save:!1,order_id:"",explain:"",selected_explain:!0,price:"",goods_sku_id:"",goods_num:"",goods_spec_id:"",remarks:""}},components:{},props:{},onLoad:function(t){wx.setStorageSync("a",[]),1==t.now_buy&&this.setData({now_buy:1,goods_sku_id:t.goods_sku_id,goods_num:t.goods_num,buy_num:t.goods_num,goods_spec_id:t.goods_spec_id});var e=this;this.dzxyFun(),!t.type||1!=t.type&&2!=t.type||e.setData({type:t.type}),t.ids?e.setData({ids:t.ids}):wx.navigateBack({}),1==e.type?e.setData({p_id:e.ids,ct_id:""}):2==e.type&&e.setData({p_id:"",ct_id:e.ids});var a={ct_id:e.ct_id,p_id:e.p_id,goods_sku_id:e.goods_sku_id,goods_num:e.goods_num,goods_spec_id:e.goods_spec_id};util.ajax("/api/goods/settlement",a,function(t){0==t.data.send_status&&wx.showToast({title:"当前地址不在配送范围哦 ~",icon:"none"}),e.setData({goods:t.data.goods,address:t.data.address,total:t.data.total,totals:t.data.total.toFixed(2),integral:t.data.score,transport_total:t.data.transport_total,price:t.data.total})})},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{linkTo:function(){wx.navigateTo({url:"../shaddress/shaddress?quantity="+this.buy_num+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&score="+this.selected_integral+"&cp_id="+this.discount+"&goods_sku_id="+this.goods_sku_id})},changeData:function(t){this.setData({address:t})},pay:function(){var e=this;if(this.selected_explain){if(1==this.now_buy){t("log",this.remarks," at pages\\product-detail\\sureOrder\\sureOrder.vue:492");var a={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,invoiceArr:this.invoiceArr,account:this.invoiceArr.content,account_type:this.invoiceArr.acc_type,goods_sku_id:e.goods_sku_id,mark:this.remarks}}else{t("log",this.remarks," at pages\\product-detail\\sureOrder\\sureOrder.vue:508");a={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,invoiceArr:this.invoiceArr,account:this.invoiceArr.content,account_type:this.invoiceArr.acc_type,goods_sku_id:e.goods_sku_id,mark:this.remarks}}1==this.selected_other?util.ajax("/api/goods/downOrder",a,function(t){e.setData({order_id:t.data.order_id}),util.ajax("/api/goods/repay_other",{order_id:t.data.order_id},function(t){e.setData({ewm:t.data.code,is_ewm:!0});var a=wx.getFileSystemManager();a.writeFile({filePath:wx.env.USER_DATA_PATH+"/test.png",data:e.ewm.slice(22),encoding:"base64",success:function(t){wx.saveImageToPhotosAlbum({filePath:wx.env.USER_DATA_PATH+"/test.png",success:function(t){e.setData({is_save:!0})},fail:function(t){}})},fail:function(t){}})})}):util.ajax("/api/goods/downOrder",a,function(t){2!=t.status?util.ajax("/api/paygoods/pay",{order_id:t.data.order_id},function(e){wx.requestPayment({timeStamp:String(e.data.timeStamp),nonceStr:e.data.nonceStr,package:e.data.package,signType:e.data.signType,paySign:e.data.paySign,success:function(e){wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+t.data.order_id})},fail:function(){wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+t.data.order_id})},complete:function(){}})}):wx.showToast({title:t.msg,icon:"none"})})}else wx.showToast({title:"请先同意电子协议",icon:"none"})},linkToMy:function(t){var e=t.currentTarget.dataset.money;wx.navigateTo({url:"/pages/my/mydiscount/mydiscount?way=1&money="+e+"&prv_money="+this.prv_money+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&ar_id="+this.address.ar_id+"&score="+this.selected_integral+"&quantity="+this.buy_num+"&cp_id="+this.discount+"&price="+this.price+"&goods_sku_id="+this.goods_sku_id})},selectList:function(t){if(!this.address)return wx.showToast({title:"请先选择收货地址",icon:"none"}),!1;var e=this.integral/100,a=parseFloat(e.toFixed(2));if(this.setData({selected_integral:!this.selected_integral}),1==this.selected_integral){if(0==this.flag_y){this.setData({flag_n:!1});var i=(this.totals-a).toFixed(2);i<=0&&(i=.01),this.jf()}}else{if(0==this.flag_n){i=(parseFloat(this.totals)+parseFloat(a)).toFixed(2);this.jf()}this.setData({flag_y:!1})}},addCount:function(t){var e=t.currentTarget.dataset.index,a=(t.currentTarget.dataset.ct_id,t.currentTarget.dataset.goods_price),i=this.goods;if(parseFloat(i[e].quantity)+1<=1)return!1;i[e].quantity=parseFloat(i[e].quantity)+1;var s=parseFloat(a*i[e].quantity)+parseFloat(this.transport_total);this.setData({goods:i,totals:s.toFixed(2),buy_num:i[e].quantity}),this.jf()},minusCount:function(t){var e=this,a=t.currentTarget.dataset.index,i=(t.currentTarget.dataset.ct_id,t.currentTarget.dataset.coupon_price),s=this.goods;if(s[a].quantity<=1)return!1;s[a].quantity=parseFloat(s[a].quantity)-1;var o=parseFloat(i*s[a].quantity)+parseFloat(e.transport_total);this.setData({goods:s,totals:o.toFixed(2),buy_num:s[a].quantity}),this.jf()},changeNum:function(t){var e=this,a=t.currentTarget.dataset.index,i=t.currentTarget.dataset.coupon_price,s=e.goods;s[a].quantity=t.detail.value,e.setData({goods:s,buy_num:t.detail.value});var o=parseFloat(i*t.detail.value)+parseFloat(e.transport_total);e.setData({totals:o.toFixed(2)}),this.jf()},jf:function(){this.address||this.setData({address:""}),t("log",this.buy_num," at pages\\product-detail\\sureOrder\\sureOrder.vue:717");var e={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,goods_sku_id:this.goods_sku_id},a=this;util.ajax("/api/goods/OrderMoney",e,function(t){a.setData({integral:t.data.use_integral,totals:t.data.amount.toFixed(2),price:t.data.prices,transport_total:t.data.transport})})},selectListOther:function(t){this.setData({selected_other:!this.selected_other})},closeEwm:function(){this.setData({is_ewm:!1}),wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+this.order_id})},selectExplain:function(t){this.setData({selected_explain:!this.selected_explain})},explainFun:function(){this.setData({is_dzxy:!0})},hideExplain:function(){this.setData({is_dzxy:!1})},dzxyFun:function(){var t=this;util.ajax("/api/index/getSystemDesc",{type:5},function(e){t.setData({dzxy:e.data})})},toDzxy:function(){wx.navigateTo({url:"/pages/dzxy/dzxy"})},invoice:function(){wx.navigateTo({url:"/pages/invoice/invoice"})},toTop:function(t){var e=this;e.pageScrollTo({scrollTop:0,duration:0})},bindRemarksAreaBlur:function(t){this.setData({remarks:t.detail.value})}}};e.default=i}).call(this,a("0de9")["default"])},fa0c:function(t,e,a){"use strict";a.r(e);var i=a("0c61"),s=a("5bb6");for(var o in s)"default"!==o&&function(t){a.d(e,t,function(){return s[t]})}(o);a("a8ff");var n,d=a("f0c5"),r=Object(d["a"])(s["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],n);e["default"]=r.exports}},[["dbdf","common/runtime","common/vendor"]]]);