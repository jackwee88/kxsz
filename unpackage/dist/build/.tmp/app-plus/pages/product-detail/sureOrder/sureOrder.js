(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/product-detail/sureOrder/sureOrder"],{"5bb6":function(t,e,i){"use strict";i.r(e);var s=i("eb34"),a=i.n(s);for(var n in s)"default"!==n&&function(t){i.d(e,t,function(){return s[t]})}(n);e["default"]=a.a},a8ff:function(t,e,i){"use strict";var s=i("e02a"),a=i.n(s);a.a},ce99:function(t,e,i){"use strict";var s,a=function(){var t=this,e=t.$createElement;t._self._c},n=[];i.d(e,"b",function(){return a}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return s})},dbdf:function(t,e,i){"use strict";(function(t){i("f9cd"),i("921b");s(i("66fd"));var e=s(i("fa0c"));function s(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("6e42")["createPage"])},e02a:function(t,e,i){},eb34:function(t,e,i){"use strict";(function(t,s){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i("60db"),n=(i("ec2b"),{data:function(){return{invoiceArr:{},is_fp:"不开发票",dzxy:"",is_dzxy:"",ewm:"",is_ewm:!1,moneys:"",discount:"",integral:"109",storeimg:"https://kxsx-front-pic.oss-cn-beijing.aliyuncs.com/test/chanpintu.png",title:"多功能尺子教学全套课程",guankan:"永久观看",selected:!0,selected_integral:!1,type:1,ids:"",ct_id:"",p_id:"",goods:[],address:{},total:0,totals:"",flag_y:!1,flag_n:!1,prv_money:0,transport_total:0,selected_num:0,num:0,buy_num:1,now_buy:"",selected_other:!1,is_save:!1,order_id:"",explain:"",selected_explain:!0,price:"",goods_sku_id:"",goods_num:"",goods_spec_id:"",remarks:"",banner:""}},components:{},props:{},onLoad:function(e){var i=this;wx.setStorageSync("a",[]),this.banner=JSON.parse(decodeURIComponent(e.sureOrder)),1==this.banner.now_buy&&(this.now_buy=1,this.goods_sku_id=this.banner.goods_sku_id,this.goods_num=this.banner.goods_num,this.buy_num=this.banner.goods_num,this.goods_spec_id=this.banner.goods_spec_id);var s=this;this.dzxyFun(),!s.banner.type||1!=s.banner.type&&2!=s.banner.type||(this.type=s.banner.type),s.banner.ids?this.ids=s.banner.ids:t.navigateBack({}),1==s.type?(this.p_id=s.ids,this.ct_id=""):2==s.type&&(this.p_id="",this.ct_id=s.ids);(0,a.ajax)({url:"goods/settlement",data:{ct_id:this.ct_id,p_id:this.p_id,goods_sku_id:this.goods_sku_id,goods_num:this.goods_num,goods_spec_id:this.goods_spec_id},success:function(e){0==e.data.data.send_status?t.showToast({title:"当前地址不在配送范围哦 ~",icon:"none"}):(i.goods=e.data.data.goods,i.address=e.data.data.address,i.total=e.data.data.total,i.totals=e.data.data.total.toFixed(2),i.integral=e.data.data.score,i.transport_total=e.data.data.transport_total,i.price=e.data.data.total)}})},onShow:function(){},onHide:function(){},onUnload:function(){},onPullDownRefresh:function(){},onReachBottom:function(){},onShareAppMessage:function(){},methods:{linkTo:function(){wx.navigateTo({url:"../../shoppingcart/shaddress/shaddress?quantity="+this.buy_num+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&score="+this.selected_integral+"&cp_id="+this.discount+"&goods_sku_id="+this.goods_sku_id})},changeData:function(t){this.setData({address:t})},pay:function(){var e=this,i=this;if(this.selected_explain){var n,o;if(void 0==this.invoiceArr.content?(n=" ",o=""):(n=this.invoiceArr.content,o=this.invoiceArr.acc_type),1==this.now_buy)var d={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,invoiceArr:"",account:n,account_type:o,goods_sku_id:i.goods_sku_id,mark:this.remarks};else d={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,invoiceArr:JSON.stringify(this.invoiceArr),account:this.invoiceArr.content,account_type:this.invoiceArr.acc_type,goods_sku_id:i.goods_sku_id,mark:this.remarks};1==this.selected_other?(0,a.ajax)({url:"goods/downOrder",data:d,header:{"content-type":"application/json"},success:function(t){e.order_id=t.data.order_id,(0,a.ajax)({url:"goods/repay_other",data:{order_id:t.data.order_id},success:function(t){e.ewm=t.data.code,e.is_ewm=!0;var s=wx.getFileSystemManager();s.writeFile({filePath:wx.env.USER_DATA_PATH+"/test.png",data:i.ewm.slice(22),encoding:"base64",success:function(t){wx.saveImageToPhotosAlbum({filePath:wx.env.USER_DATA_PATH+"/test.png",success:function(t){this.is_save=!0},fail:function(t){}})},fail:function(t){}})}})}}):(0,a.ajax)({url:"goods/downOrder",data:d,header:{"content-type":"application/json"},success:function(e){if(2==e.status)return s("log","res"+e," at pages\\product-detail\\sureOrder\\sureOrder.vue:545"),void t.showToast({title:e.msg,icon:"none"});(0,a.ajax)({url:"paygoods/pay",data:{order_id:e.data.data.order_id},success:function(t){wx.requestPayment({timeStamp:String(t.data.timeStamp),nonceStr:t.data.nonceStr,package:t.data.package,signType:t.data.signType,paySign:t.data.paySign,success:function(t){s("log","1321654654"," at pages\\product-detail\\sureOrder\\sureOrder.vue:566"),wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+e.data.order_id})},fail:function(){wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+e.data.order_id})},complete:function(){}})}})}})}else t.showToast({title:"请先同意电子协议",icon:"none"})},linkToMy:function(t){var e=t.currentTarget.dataset.money;wx.navigateTo({url:"/pages/my/mydiscount/mydiscount?way=1&money="+e+"&prv_money="+this.prv_money+"&ct_id="+this.ct_id+"&p_id="+this.goods[0].p_id+"&ar_id="+this.address.ar_id+"&score="+this.selected_integral+"&quantity="+this.buy_num+"&cp_id="+this.discount+"&price="+this.price+"&goods_sku_id="+this.goods_sku_id})},selectList:function(t){if(!this.address)return wx.showToast({title:"请先选择收货地址",icon:"none"}),!1;var e=this.integral/100,i=parseFloat(e.toFixed(2));if(this.selected_integral=!this.selected_integral,1==this.selected_integral){if(0==this.flag_y){this.flag_n=!1;var s=(this.totals-i).toFixed(2);s<=0&&(s=.01),this.jf()}}else{if(0==this.flag_n){s=(parseFloat(this.totals)+parseFloat(i)).toFixed(2);this.jf()}this.flag_y=!1}},jf:function(){var t=this;this.address||(this.address="");var e={ct_id:this.ct_id,p_id:this.goods[0].p_id,ar_id:this.address.ar_id,score:this.selected_integral,cp_id:this.discount,quantity:this.buy_num,goods_sku_id:this.goods_sku_id};(0,a.ajax)({url:"goods/OrderMoney",data:e,success:function(e){t.integral=e.data.data.use_integral,t.totals=e.data.data.amount.toFixed(2),t.price=e.data.data.prices,t.transport_total=e.data.data.transport}})},selectListOther:function(t){this.selected_other=!this.selected_other},closeEwm:function(){this.is_ewm=!1,wx.redirectTo({url:"/pages/onlinestore/orderdetails/orderdetails?order_id="+this.order_id})},selectExplain:function(t){this.setData({selected_explain:!this.selected_explain})},explainFun:function(){this.is_dzxy=!0},hideExplain:function(){this.is_dzxy=!1},dzxyFun:function(){var t=this;(0,a.ajax)({url:"index/getSystemDesc",data:{type:5},success:function(e){t.dzxy=e.data.data}})},toDzxy:function(){wx.navigateTo({url:"/pages/dzxy/dzxy"})},invoice:function(){t.navigateTo({url:"/pages/invoice/invoice"})},toTop:function(t){var e=this;e.pageScrollTo({scrollTop:0,duration:0})},bindRemarksAreaBlur:function(t){this.remarks=t.detail.value}}});e.default=n}).call(this,i("6e42")["default"],i("0de9")["default"])},fa0c:function(t,e,i){"use strict";i.r(e);var s=i("ce99"),a=i("5bb6");for(var n in a)"default"!==n&&function(t){i.d(e,t,function(){return a[t]})}(n);i("a8ff");var o,d=i("f0c5"),r=Object(d["a"])(a["default"],s["b"],s["c"],!1,null,null,null,!1,s["a"],o);e["default"]=r.exports}},[["dbdf","common/runtime","common/vendor"]]]);